(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{487:function(s,n,t){"use strict";t.r(n);var a=t(21),e=Object(a.a)({},(function(){var s=this,n=s.$createElement,t=s._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"nginx笔记"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx笔记"}},[s._v("#")]),s._v(" nginx笔记")]),s._v(" "),t("h2",{attrs:{id:"下载与安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载与安装"}},[s._v("#")]),s._v(" 下载与安装")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("官网下载nginx和pcre压缩包")])]),s._v(" "),t("li",[t("p",[s._v("安装pcre依赖")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("先解压"),t("code",[s._v("tar -xvf pcre2-10.34.tar.gz")])])]),s._v(" "),t("li",[t("p",[s._v("进入解压的文件"),t("code",[s._v("cd pcre2-10.34")])])]),s._v(" "),t("li",[t("p",[s._v("执行配置"),t("code",[s._v("./configure")])])]),s._v(" "),t("li",[t("p",[s._v("编译并安装"),t("code",[s._v("make && make install")])])]),s._v(" "),t("li",[t("p",[s._v("查看版本号"),t("code",[s._v("pcre-config --version")])])])])]),s._v(" "),t("li",[t("p",[s._v("安装其他依赖"),t("code",[s._v("yum -y install make zlib zlib-devel gcc c++ libtool openssl openssl-devel")])])]),s._v(" "),t("li",[t("p",[s._v("安装nginx")]),s._v(" "),t("ul",[t("li",[s._v("先解压"),t("code",[s._v("tar -xvf nginx-1.16.1.tar.gz")])]),s._v(" "),t("li",[s._v("执行配置"),t("code",[s._v("./configure")])]),s._v(" "),t("li",[s._v("编译并安装"),t("code",[s._v("make && make install")])]),s._v(" "),t("li",[s._v("安装成功之后/usr/local/nginx/sbin文件夹")])])]),s._v(" "),t("li",[t("p",[s._v("启动nginx，"),t("code",[s._v("cd /usr/local/nginx/sbin")]),s._v("，执行"),t("code",[s._v("./nginx")]),s._v("，查看进程"),t("code",[s._v("ps -ef | grep nginx")])])]),s._v(" "),t("li",[t("p",[s._v("在"),t("code",[s._v("/usr.local/nginx/conf")]),s._v("目录下有"),t("code",[s._v("nginx.conf")]),s._v("配置文件")])])]),s._v(" "),t("h2",{attrs:{id:"防火墙相关"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#防火墙相关"}},[s._v("#")]),s._v(" 防火墙相关")]),s._v(" "),t("ol",[t("li",[s._v("开启防火墙"),t("code",[s._v("systemctl start firewalld")])]),s._v(" "),t("li",[s._v("查看防火墙状态"),t("code",[s._v("systemctl status firewalld")])]),s._v(" "),t("li",[s._v("查看防火墙开放端口"),t("code",[s._v("firewall-cmd --list-all")])]),s._v(" "),t("li",[s._v("永久开放http"),t("code",[s._v("firewall-cmd --add-service=http --permanent")])]),s._v(" "),t("li",[s._v("开放某个端口"),t("code",[s._v("firewall-cmd --add-port=80/tcp --permanent")])]),s._v(" "),t("li",[s._v("关闭某个端口号"),t("code",[s._v("firewall-cmd --remove-port=80/tcp --permanent")])]),s._v(" "),t("li",[s._v("重启防火墙"),t("code",[s._v("firewall-cmd --reload")])]),s._v(" "),t("li",[s._v("关闭防火墙"),t("code",[s._v("systemctl stop firewalld")])])]),s._v(" "),t("h2",{attrs:{id:"nginx常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx常用命令"}},[s._v("#")]),s._v(" nginx常用命令")]),s._v(" "),t("blockquote",[t("p",[s._v("前提条件：进入/usr/local/nginx/sbin目录中")])]),s._v(" "),t("ul",[t("li",[s._v("查看nginx版本号："),t("code",[s._v("./nginx -v")])]),s._v(" "),t("li",[s._v("启动nginx："),t("code",[s._v("./nginx")])]),s._v(" "),t("li",[s._v("关闭nginx："),t("code",[s._v("./nginx -s stop")])]),s._v(" "),t("li",[s._v("重新加载nginx（改了nginx.conf就重新加载）："),t("code",[s._v("./nginx -s reload")])])]),s._v(" "),t("h2",{attrs:{id:"nginx的配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx的配置文件"}},[s._v("#")]),s._v(" nginx的配置文件")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("所在位置："),t("code",[s._v("/usr/local/nginx/conf/nginx.conf")])])]),s._v(" "),t("li",[t("p",[s._v("文件组成与说明：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### ----------------- start 全局块 --------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 全局块从配置文件开始到events块之间的内容，主要设置一些影响nginx服务器整体运行的配置指令")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#user  nobody;")]),s._v("\nworker_processes  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### worker_processes值越大，可以支持的并发处理量越大")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_log  logs/error.log;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_log  logs/error.log  notice;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_log  logs/error.log  info;")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#pid        logs/nginx.pid;")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### ----------------------- end 全局块 ---------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### ----------------------- start events块 --------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### events块主要影响nginx服务器与用户的网络连接")]),s._v("\n\nevents "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    worker_connections  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 支持的最大连接数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### -------------------- end events块 ----------------------------")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### ----------------------- start http块 --------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 服务器配置最频繁的一部分，代理、缓存和日志定义等绝大多数功能和第三方模块的配置都在这里")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### http块包含http全局块和server块")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### （1）http全局块: 文件引入、MIME-TYPE定义、日志自定义、连接超时时间、单链接请求数上限等")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### （2）server块：和虚拟主机有密切相关，里面包括了全局server和location")]),s._v("\nhttp "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    include       mime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("types"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    default_type  application"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("octet"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("stream"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#                  '$status $body_bytes_sent \"$http_referer\" '")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#                  \'"$http_user_agent" "$http_x_forwarded_for"\';')]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#access_log  logs/access.log  main;")]),s._v("\n\n    sendfile        on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#tcp_nopush     on;")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#keepalive_timeout  0;")]),s._v("\n    keepalive_timeout  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#gzip  on;")]),s._v("\n\n    server "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name  localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#charset koi8-r;")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#access_log  logs/host.access.log  main;")]),s._v("\n\n        location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root   html"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            index  index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_page  404              /404.html;")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redirect server error pages to the static page /50x.html")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n        error_page   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("50x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("50x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root   html"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy the PHP scripts to Apache listening on 127.0.0.1:80")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location ~ \\.php$ {")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    proxy_pass   http://127.0.0.1;")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location ~ \\.php$ {")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    root           html;")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    fastcgi_pass   127.0.0.1:9000;")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    fastcgi_index  index.php;")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    include        fastcgi_params;")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# deny access to .htaccess files, if Apache's document root")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# concurs with nginx's one")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location ~ /\\.ht {")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    deny  all;")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# another virtual host using mix of IP-, name-, and port-based configuration")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#server {")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    listen       8000;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    listen       somename:8080;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server_name  somename  alias  another.alias;")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    location / {")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        root   html;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        index  index.html index.htm;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    }")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HTTPS server")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#server {")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    listen       443 ssl;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server_name  localhost;")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    ssl_certificate      cert.pem;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    ssl_certificate_key  cert.key;")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    ssl_session_cache    shared:SSL:1m;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    ssl_session_timeout  5m;")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    ssl_ciphers  HIGH:!aNULL:!MD5;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    ssl_prefer_server_ciphers  on;")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    location / {")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        root   html;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        index  index.html index.htm;")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    }")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#\t}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### ----------------------- end http块 --------------------")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br"),t("span",{staticClass:"line-number"},[s._v("103")]),t("br"),t("span",{staticClass:"line-number"},[s._v("104")]),t("br"),t("span",{staticClass:"line-number"},[s._v("105")]),t("br"),t("span",{staticClass:"line-number"},[s._v("106")]),t("br"),t("span",{staticClass:"line-number"},[s._v("107")]),t("br"),t("span",{staticClass:"line-number"},[s._v("108")]),t("br"),t("span",{staticClass:"line-number"},[s._v("109")]),t("br"),t("span",{staticClass:"line-number"},[s._v("110")]),t("br"),t("span",{staticClass:"line-number"},[s._v("111")]),t("br"),t("span",{staticClass:"line-number"},[s._v("112")]),t("br"),t("span",{staticClass:"line-number"},[s._v("113")]),t("br"),t("span",{staticClass:"line-number"},[s._v("114")]),t("br"),t("span",{staticClass:"line-number"},[s._v("115")]),t("br"),t("span",{staticClass:"line-number"},[s._v("116")]),t("br"),t("span",{staticClass:"line-number"},[s._v("117")]),t("br"),t("span",{staticClass:"line-number"},[s._v("118")]),t("br"),t("span",{staticClass:"line-number"},[s._v("119")]),t("br"),t("span",{staticClass:"line-number"},[s._v("120")]),t("br"),t("span",{staticClass:"line-number"},[s._v("121")]),t("br"),t("span",{staticClass:"line-number"},[s._v("122")]),t("br"),t("span",{staticClass:"line-number"},[s._v("123")]),t("br"),t("span",{staticClass:"line-number"},[s._v("124")]),t("br"),t("span",{staticClass:"line-number"},[s._v("125")]),t("br")])])])]),s._v(" "),t("h2",{attrs:{id:"nginx配置实例-反向代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置实例-反向代理"}},[s._v("#")]),s._v(" nginx配置实例-反向代理")]),s._v(" "),t("h4",{attrs:{id:"实例一"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实例一"}},[s._v("#")]),s._v(" 实例一")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("实现效果：")]),s._v(" "),t("p",[s._v("（1）打开浏览器，输入www.123.com，跳转到linux中的某个主页，这里以http://106.54.2.108:3000为例")])]),s._v(" "),t("li",[t("p",[s._v("访问过程分析：")])])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Liang2uv/image_store/blog/20201117201020.png",alt:""}})]),s._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[t("p",[s._v("配置windows的host文件，"),t("code",[s._v("C:\\Windows\\System32\\drivers\\etc\\host")]),s._v("，打开host在最后一行添加"),t("code",[s._v("106.54.2.108 www.123.com")])])]),s._v(" "),t("li",[t("p",[s._v("在nginx配置反向代理")]),s._v(" "),t("p",[s._v("（1）server_name改成nginx接收的ip地址，端口是80")]),s._v(" "),t("p",[s._v("（2）location配置转发路径，即实现服务器ip")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Liang2uv/image_store/blog/20201117201148.png",alt:""}})])]),s._v(" "),t("li",[t("p",[s._v("重启nginx"),t("code",[s._v("./nginx -s reload")])])])]),s._v(" "),t("h4",{attrs:{id:"实例二"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实例二"}},[s._v("#")]),s._v(" 实例二")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("实现效果：\n（1）访问http://106.54.2.108:9001/edu/，直接跳转到127.0.0.1:8080")]),s._v(" "),t("p",[s._v("（2）访问http://106.54.2.108:9001/vod/，直接跳转到127.0.0.1:8081")])]),s._v(" "),t("li",[t("p",[s._v("nginx的配置：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Liang2uv/image_store/blog/20201117201203.png",alt:""}})]),s._v(" "),t("ul",[t("li",[t("p",[s._v("location说明：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("location "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" uri "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ol",[t("li",[s._v("= : 用于不含正则表达式的uri前，要求请求字符串与uri严格匹配，如果匹配成功，就停止继续向下搜索并立即处理请求")]),s._v(" "),t("li",[s._v("~ : 用于uri前包含正则表达式，并且区分大小写")]),s._v(" "),t("li",[s._v("~* : 用于uri前包含正则表达式，并且不区分大小写")]),s._v(" "),t("li",[s._v("^~ : 用于不含正则表达式的uri前，要求nginx服务器找到标识uri和关键字符串匹配度最高的location后，立即使用此location处理请求，而不再使用location块中的正则uri和请求字符串做匹配")])])])])])]),s._v(" "),t("h2",{attrs:{id:"nginx配置实例-负载均衡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置实例-负载均衡"}},[s._v("#")]),s._v(" nginx配置实例-负载均衡")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("实现效果：")]),s._v(" "),t("p",[s._v("（1）浏览器地址栏输入地址http://106.54.2.108:9001/fzjh/，负载均衡效果，"),t("strong",[s._v("平均")]),s._v("到8080和8081端口中")])]),s._v(" "),t("li",[t("p",[s._v("先在配置文件中创建upstram，里面配置srever存放负载均衡的服务器")])]),s._v(" "),t("li",[t("p",[s._v("在nginx服务器server里的location配置proxy_pass为http://你的创建的upstream名称")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Liang2uv/image_store/blog/20201117201221.png",alt:""}})])])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("负载均衡分配策略：")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("轮询（默认）")]),s._v(" "),t("p",[s._v("每个请求按时间顺序逐一分配到不同服务器，如果服务器down掉，能自动删除")])]),s._v(" "),t("li",[t("p",[s._v("权重weight")]),s._v(" "),t("p",[s._v("权重越高，被分配的几率越大")]),s._v(" "),t("div",{staticClass:"language-py line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-py"}},[t("code",[s._v("upstream myserver "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" weight"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),s._v(" weight"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("ip_hash")]),s._v(" "),t("p",[s._v("每个请求访问按ip的hash结果进行分配，这样每个访客固定访问一个后端服务器，可以解决session问题")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("upstream myserver "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       ip_hash"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("fair方式")]),s._v(" "),t("p",[s._v("按照后端服务器的响应时间进行分配，响应时间越短的优先分配")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("upstream myserver "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       fair"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])])])])]),s._v(" "),t("h2",{attrs:{id:"nginx的动静分离"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx的动静分离"}},[s._v("#")]),s._v(" nginx的动静分离")]),s._v(" "),t("h4",{attrs:{id:"什么是动静分离"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是动静分离"}},[s._v("#")]),s._v(" 什么是动静分离")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("简单来说就是不动态请求和静态请求分离开，而不是简单的把静态资源和动态资源物理分离，目前实现动静分离的方式分为两种：一是把静态文件放在一个独立的服务器，动态资源放在另一个服务器。二是动态和静态文件混合发布，使用nginx区分开。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Liang2uv/image_store/blog/20201117201226.png",alt:""}})])])]),s._v(" "),t("ul",[t("li",[s._v("通过location可以指定不同的后缀名实现不同的请求转发，通过expries参数设置，可以设置浏览器缓存时间，减少与服务器之间的请求和流量。具体expries定义：是给一个资源设置一个过期时间，无需服务器去验证，直接通过浏览器自身确认是否过期即可。")])]),s._v(" "),t("h4",{attrs:{id:"实例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实例"}},[s._v("#")]),s._v(" 实例")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("实现效果：")]),s._v(" "),t("p",[s._v("通过http://106.54.2.108:9001/www/可以访问到服务器上的"),t("code",[s._v("/data/www")]),s._v("文件夹下文件，通过http://106.54.2.108:9001/image/可以访问到服务器上的"),t("code",[s._v("/data/images")]),s._v("文件夹下文件")])]),s._v(" "),t("li",[t("p",[s._v("分别创建文件夹/data/www和/data/images，分别往里面放置html文件和图片文件")])]),s._v(" "),t("li",[t("p",[s._v("配置nginx")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Liang2uv/image_store/blog/20201117201233.png",alt:""}})])]),s._v(" "),t("li",[t("p",[s._v("注意：使用root配置的实际资源路径是root + location，但是使用别名alias配置的实际路径就是alias")])])]),s._v(" "),t("h2",{attrs:{id:"nginx的高可用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx的高可用"}},[s._v("#")]),s._v(" nginx的高可用")]),s._v(" "),t("h4",{attrs:{id:"什么是高可用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是高可用"}},[s._v("#")]),s._v(" 什么是高可用")]),s._v(" "),t("ol",[t("li",[s._v("需要两台服务器")]),s._v(" "),t("li",[s._v("需要keep-alive")]),s._v(" "),t("li",[s._v("需要虚拟ip")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Liang2uv/image_store/blog/20201117201240.png",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"nginx的原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx的原理"}},[s._v("#")]),s._v(" nginx的原理")]),s._v(" "),t("h4",{attrs:{id:"master和worker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#master和worker"}},[s._v("#")]),s._v(" master和worker")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Liang2uv/image_store/blog/20201117201247.png",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"worker如何工作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#worker如何工作"}},[s._v("#")]),s._v(" worker如何工作")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Liang2uv/image_store/blog/20201117201254.png",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"一个master和多个worker的好处"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一个master和多个worker的好处"}},[s._v("#")]),s._v(" 一个master和多个worker的好处")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("可以使用nginx -s reload热部署，利用nginx热部署操作")])]),s._v(" "),t("li",[t("p",[s._v("每个worker是一个独立的进程，不需要加锁，如果有其中的一个worker出现了问题，其他worker可以继续进行争抢，实现请求过程，不会中断")])]),s._v(" "),t("li",[t("p",[s._v("nginx同redis类型采用了io多路复用")])]),s._v(" "),t("li",[t("p",[s._v("每个worker数（worker_processes）和服务器cpu数量相等最为合适")])]),s._v(" "),t("li",[t("p",[s._v("连接数worker_connections")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("发送请求，占用几个连接数？")]),s._v(" "),t("p",[s._v("答案：2（普通静态访问的时候）或者4（有反向代理的时候）个")])]),s._v(" "),t("li",[t("p",[s._v("nginx有一个master，有四个worker，每个worker支持的最大连接数1024,那支持的最大并发数是多少？")]),s._v(" "),t("p",[s._v("答案：①普通的静态访问的时候，最大并发数为：worker_connections * worker_processes / 2  ②HTTP作为反向代理来说，最大并发数为：worker_connections * worker_processes / 4")])])])])])])}),[],!1,null,null,null);n.default=e.exports}}]);